<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cascade Mountain Weather | Washington Ski & Snow Forecasts</title>
    <meta name="description" content="Cascade Mountain Weather provides accurate mountain weather and snow forecasts for Washington's Cascade Range ski areas including Mt. Baker, Stevens Pass, Crystal Mountain, Snoqualmie Pass, and more.">
    <meta name="keywords" content="Cascade Mountain Weather, Washington ski forecast, Cascade Range weather, Mt Baker snow forecast, Stevens Pass weather, Crystal Mountain forecast, Snoqualmie Pass snow, PNW ski weather, backcountry skiing Washington">
    <meta name="author" content="Cascade Mountain Weather">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.cascademountainweather.com/">
    <link rel="icon" type="image/svg+xml" href="assets/images/favicon.svg">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Cascade Mountain Weather | Washington Ski & Snow Forecasts">
    <meta property="og:description" content="Accurate mountain weather and snow forecasts for Washington's Cascade Range ski areas. Your trusted source for PNW backcountry weather.">
    <meta property="og:url" content="https://www.cascademountainweather.com/">
    <meta property="og:site_name" content="Cascade Mountain Weather">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Cascade Mountain Weather | Washington Ski & Snow Forecasts">
    <meta name="twitter:description" content="Accurate mountain weather and snow forecasts for Washington's Cascade Range ski areas.">
    
    <link rel="stylesheet" href="style.css">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4ZQLW3ZS2F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-4ZQLW3ZS2F');
    </script>
</head>

<body>
    <header>
        <h1>Cascade Mountain Weather</h1>
        <p class="tagline">Mountain Weather & Snow Forecasts for PNW Backcountry Enthusiasts</p>
    </header>

    <nav>
        <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false" aria-controls="primary-nav">
            <span class="nav-toggle-bar"></span>
            <span class="nav-toggle-bar"></span>
            <span class="nav-toggle-bar"></span>
        </button>
        <ul id="primary-nav">
            <a href="index.html">Home</a>
            <li><a href="index.html#latest-post">Latest Forecast</a></li>
            <li><a href="index.html#ski-areas">Ski Areas</a></li>
            <li><a href="posts/archive.html">Archive</a></li>
            <li><a href="evaluation.html">Evaluation</a></li>
            <li class="nav-item dropdown">
                <a href="model-tools.html" class="dropdown-toggle" aria-haspopup="true" aria-expanded="false">Model tools <span class="dropdown-caret">▾</span></a>
                <ul class="dropdown-menu" role="menu" aria-label="Model tools subpages">
                  <li role="none"><a role="menuitem" href="tools/model-tools-current-weather.html">Current Weather</a></li>
                  <li role="none"><a role="menuitem" href="tools/model-tools-synoptic.html">Synoptic-scale Tools</a></li>
                  <li role="none"><a role="menuitem" href="tools/model-tools-precipitation.html">Precipitation</a></li>
                </ul>
              </li>
            <li><a href="about.html">About</a></li>
        </ul>
    </nav>

    <main>
        <section id="latest-post" class="hero">
            <h2>The Dendritic Growth Zone - Latest Weekend Forecast</h2>
            <div class="post-preview" id="latest-post-preview">
                <h3><a id="post-link" href="#">Loading latest forecast…</a></h3>
                <p class="post-date" id="post-date">&nbsp;</p>
                <p class="post-summary" id="post-summary">If you see this, the site is looking for the most recent forecast.</p>
                <a id="read-more" href="#" class="read-more">Read Full Forecast →</a>
            </div>
        </section>

        <section id="ski-areas" class="ski-areas">
            <h2>Areas we cover</h2>
            <div class="area-grid">
                <a href="./tools/mt-baker.html" class="area-card">
                    <h3>Mt. Baker Backcountry Heather Meadows</h3>
                    <p class="elevation">Base: 3,500' | Summit: 5,089'</p>
                </a>
                <a href="./tools/stevens-pass.html" class="area-card">
                    <h3>Stevens Pass</h3>
                    <p>Central Cascades - I-90 Corridor</p>
                    <p class="elevation">Base: 4,061' | Summit: 5,845'</p>
                </a>
                <a href="./tools/snoqualmie-pass.html" class="area-card">
                    <h3>Snoqualmie Pass</h3>
                    <p>Summit Central, West, East, Alpental</p>
                    <p class="elevation">Base: 3,000' | Summit: 5,420'</p>
                </a>
                <a href="./tools/blewett-pass.html" class="area-card">
                    <h3>Blewett Pass</h3>
                    <p>East of Cascades - Backcountry</p>
                    <p class="elevation">Elevation: ~4,100'</p>
                </a>
                <a href="./tools/tools/crystal-mountain.html" class="area-card">
                    <h3>Crystal Mountain</h3>
                    <p>Mt. Rainier Area - Largest in WA</p>
                    <p class="elevation">Base: 4,400' | Summit: 7,012'</p>
                </a>
                <a href="./tools/paradise.html" class="area-card">
                    <h3>Paradise - Mt. Rainier</h3>
                    <p>Muir and Tatoosh Access</p>
                    <p class="elevation">Base: 5,400' | Summit: 10,000'</p>
                <a href="./tools/white-pass.html" class="area-card">
                    <h3>White Pass</h3>
                    <p>South Cascades - US 12 Corridor</p>
                    <p class="elevation">Base: 4,500' | Summit: 6,000'</p>
                </a>
            </div>
        </section>

        <section id="recent-posts" class="recent-posts">
            <h2>Recent Forecasts</h2>
            <ul class="post-list" id="recent-posts-list">
                <li class="placeholder">Loading recent posts…</li>
            </ul>
        </section>
    </main>

    <footer>
        <p>Cascade Mountain Weather | Washington Ski Area Forecasts</p>
        <p>For educational purposes only. Always check official sources and avalanche forecasts before heading to the mountains. We are not liable for any damages or injuries resulting from the use of this information.</p>
    </footer>
        <!-- Load latest post summary and populate recent posts -->
        <script>
        (async function(){
            const setText = (id, text) => { const el = document.getElementById(id); if(el) el.textContent = text; };
            const setHref = (id, href) => { const el = document.getElementById(id); if(el) el.href = href; };

            async function fetchLatestSummary(){
                try{
                    const res = await fetch('posts/latest-post-summary.html');
                    if(!res.ok) throw new Error('no summary');
                    const text = await res.text();
                    const scriptMatch = text.match(/<script[^>]*>([\s\S]*?)<\/script>/i);
                    if(scriptMatch){
                        try{ (new Function(scriptMatch[1]))(); }catch(e){}
                    }
                    const temp = document.createElement('div');
                    temp.innerHTML = text;
                    const tagline = (typeof post_tagline !== 'undefined' && post_tagline) ? post_tagline : (temp.querySelector('#post-tagline')?.textContent || '');
                    const date = (typeof post_date !== 'undefined' && post_date) ? post_date : (temp.querySelector('#post-date')?.textContent || '');
                    const summary = (typeof post_summary !== 'undefined' && post_summary) ? post_summary : (temp.querySelector('#post-summary')?.textContent || '');
                    const href = (typeof post_href !== 'undefined' && post_href) ? post_href : (temp.querySelector('#post-href')?.getAttribute('href') || '');
                    return {tagline,date,summary,href};
                }catch(e){
                    return null;
                }
            }

            async function exists(path){
                try{
                    const res = await fetch(path, {method:'HEAD'});
                    if(res && res.ok) return true;
                    const res2 = await fetch(path);
                    return res2 && res2.ok;
                }catch(e){ return false; }
            }

            async function fetchPostTitle(path){
                try{
                    const res = await fetch(path);
                    if(!res.ok) return null;
                    const text = await res.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(text, 'text/html');
                    const postHeader = doc.querySelector('.post-header');
                    if(postHeader){
                        const h = postHeader.querySelector('h1, h2');
                        if(h && h.textContent.trim()) return h.textContent.replace(/\s+/g,' ').trim();
                    }
                    const hAnywhere = doc.querySelector('h1, h2');
                    if(hAnywhere) return hAnywhere.textContent.replace(/\s+/g,' ').trim();
                    const t = doc.querySelector('title');
                    if(t) return t.textContent.replace(/\s+/g,' ').trim();
                }catch(e){}
                return null;
            }

            function dateToPath(d){
                const yyyy = d.getFullYear();
                const mm = String(d.getMonth()+1).padStart(2,'0');
                const dd = String(d.getDate()).padStart(2,'0');
                return `posts/${yyyy}-${mm}-${dd}-weekend-forecast.html`;
            }

            async function findRecentWeekends(maxDays=365, maxResults=3){
                const results = [];
                const today = new Date();
                for(let i=0;i<maxDays && results.length<maxResults;i++){
                    const d = new Date();
                    d.setDate(today.getDate()-i);
                    const path = dateToPath(d);
                    if(await exists(path)){
                        const title = await fetchPostTitle(path);
                        results.push({href:path, date:d, title});
                    }
                }
                return results;
            }

            async function findLatestWeekend(maxDays=90){
                const r = await findRecentWeekends(maxDays,1);
                return r.length? r[0] : null;
            }

            // populate latest post area (existing behavior)
            const summary = await fetchLatestSummary();
            let href = summary && summary.href ? summary.href : '';
            if(!href){
                const found = await findLatestWeekend(90);
                if(found) href = found.href;
            }
            if(summary){
                if(summary.tagline) setText('post-link', summary.tagline);
                if(summary.date) setText('post-date', 'Posted: ' + summary.date);
                if(summary.summary) setText('post-summary', summary.summary);
            }
            if(href){
                setHref('post-link', href);
                setHref('read-more', href);
            } else {
                setText('post-link', 'No recent forecast found');
                setText('read-more', '');
            }

            // populate up to 3 recent posts
            const recentContainer = document.getElementById('recent-posts-list');
            if(recentContainer){
                recentContainer.innerHTML = '<li class="placeholder">Searching for recent posts…</li>';
                const recent = await findRecentWeekends(365, 3);
                recentContainer.innerHTML = '';
                if(recent.length===0){
                    recentContainer.innerHTML = '<li>No recent posts found.</li>';
                } else {
                    for(const p of recent){
                        const li = document.createElement('li');
                        const a = document.createElement('a'); a.href = p.href;
                        const spanDate = document.createElement('span'); spanDate.className='post-date';
                        spanDate.textContent = p.date.toLocaleDateString(undefined, {month:'short', day:'numeric', year:'numeric'});
                        const spanTitle = document.createElement('span'); spanTitle.className='post-title';
                        spanTitle.textContent = p.title ? p.title : p.href.split('/').pop().replace(/-/g,' ').replace('.html','');
                        a.appendChild(spanDate); a.appendChild(document.createTextNode(' ')); a.appendChild(spanTitle);
                        li.appendChild(a);
                        recentContainer.appendChild(li);
                    }
                }
            }

        })();
        </script>
        <!-- Shared header behavior loaded from assets -->
        <script src="assets/header.js" defer></script>
</body>
</html>
